<div class="container">
  <div class="row mt-5">
    <div class="col-md-4">
      <div class="anime-picture text-center">
        <%= attachment_image_tag @anime, :anime_image, format: 'jpeg', fallback: "no_image.jpg", class: "mt-3" %>
      </div>
      <div class="like-contents text-center mt-1">
        <% if current_user.already_liked?(@anime) %>
          <%= link_to anime_like_path(@anime.id), method: :delete do %>
            <i class="fas fa-heart">いいね</i>
          <% end %>
        <% else %>
          <%= link_to anime_like_path(@anime.id), method: :create do %>
            <i class="far fa-heart">いいね</i>
          <% end %>
        <% end %>
        <%= @anime.likes.count %>
      </div>
    </div>
      <div class="col-md-6 ml-3">
        <div class="d-flex anime-title">
          <h2><%= @anime.title %></h2>
          <div class="user-picture">
            <%= link_to user_path(@anime.user.id) do %>
            <%= attachment_image_tag @anime.user, :image, format: 'jpeg', fallback: "no_image.jpg", class: "ml-2" %>
            <% end %>
          </div>
        </div>
        <div class="star-raty">
          <div id="star-rate-<%= @anime.id %>"></div>
          <script>
           $('#star-rate-<%= @anime.id %>').raty({
             size: 36,
             starOff:  '<%= asset_path('star-off.png') %>',
             starOn : '<%= asset_path('star-on.png') %>',
             starHalf: '<%= asset_path('star-half.png') %>',
             half: true,
             readOnly: true,
             score: <%= @anime.rate %>,
           });
           </script>
         </div>
         <div class="star-view">
           <%= @anime.rate %>
         </div>
         <div class="mt-3 border-bottom thought-head">感想</div>
         <p class="thought-text mt-1">
           <%= @anime.thought %>
         </p>
       </div>
  </div>
  <div class="row mt-3 ml-5">
    <div class="col-md-10">
      <div id="comment-new">
        <button class="btn btn-secondary">コメント入力</button>
      </div>
      <div class="mt-2" id="comment-form">
        <%= form_with(model: [@anime, @comment], local: true) do |f| %>
        <%= f.text_area :comment, :size=>"60x3", placeholder: "コメントする" %>
        <%= f.submit "送信する", class: "btn btn-success btn-sm" %>
        <% end %>
      </div>
      <p>コメント件数: <%= @comments.count %></p>
      <% @comments.each do |comment| %>
      <div class="comment-index mb-2 border rounded bg-light py-2">
        <%= attachment_image_tag comment.user, :image, :fill, 50, 50, format: 'jpeg', fallback: "no_image.jpg", style: "border-radius:50%" %>
        <%= comment.user.name %>
        <%= comment.created_at.strftime('%Y/%m/%d') %></br>
        <div class="comment-delete">
          <%= comment.comment %>
          <% if comment.user == current_user %>
          <%= link_to "削除", anime_comment_path(comment.anime, comment), method: :delete, data: { confirm: "削除しますか？"}, class: "btn btn-danger btn-sm" %>
        </div>
      </div>
          <% end %>
      <% end %>
      <%= paginate @comments %>
    </div>
  </div>
</div>